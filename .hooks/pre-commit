#!/usr/bin/env bash

source scripts/lint/lint.sh

# Validate commit message using commitlint (if available)
if command -v npx &> /dev/null; then
    echo "- Validating commit message with commitlint"
    if [ -f .git/COMMIT_EDITMSG ]; then
        npx --no-install commitlint --edit .git/COMMIT_EDITMSG
        if [ $? -ne 0 ]; then
            echo "Commit message does not follow conventional commits format"
            echo "Expected format: <type>(<scope>): <subject>"
            echo "Example: feat: add new authentication method"
            echo "Allowed types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert"
            exit 1
        fi
    fi
fi

run_linter --build-folder "./..." --do-not-check-main $1
